<center><h1>åŸºäºcommanderæ‰“é€ è‡ªå·±ä¸šåŠ¡çš„è„šæ‰‹æ¶</h1></center>

## å‰è¨€
éšç€ä¸šåŠ¡çš„å‘å±•ï¼Œä¸€ä¸ªå…¬å¸å¯èƒ½æœ‰å¤šä¸ªéƒ¨é—¨ä½¿ç”¨åŒä¸€ä¸ªæŠ€æœ¯è¿­ä»£ä¸šåŠ¡ï¼Œè¿™æ—¶å€™å°±äº§ç”Ÿäº†ä¸€ä¸ªé—®é¢˜ï¼Œè¿™ä¹ˆå¤šé›·åŒçš„é¡¹ç›®ä¸èƒ½æ€»æ˜¯æ‹·è´ï¼Œæ‰“é€ ç¬¦åˆè‡ªå·±å…¬å¸çš„è„šæ‰‹æ¶åº”è¿è€Œç”Ÿã€‚
åˆ†äº«ä¸€ä¸‹æˆ‘è‡ªå·±å†™çš„ä¸€ä¸ªreact-nativeçš„è„šæ‰‹æ¶.


## æ•ˆæœ
<img src="https://img-blog.csdnimg.cn/ad42d54249bf45038642241e3c67e10c.png#pic_center" width="480" /><br/>
<img src="https://img-blog.csdnimg.cn/3123ee4531ad4f8bbe1b45d96d1c0351.png#pic_center" width="580" /><br/>

## æŠ€æœ¯é€‰å‹
- åŸºäºcommanderçš„å‘½ä»¤è¡Œæ¡†æ¶
- åŸºäºreact-native0.55.4ç‰ˆæœ¬ï¼Œé›†æˆäº†reduxã€typescriptã€react-navigation demo
- æ‰“åŒ…è„šæœ¬
- ä»£ç è§„èŒƒeslint

## æ¶æ‰‹æ¶å…¥å£
```
#!/usr/bin/env node
import { Command } from 'commander'
import { init } from './command/init'
import { fix } from './command/fix'
import { bundle } from './command/bundle'
import { zipBundle } from './command/zip'
const pkg = require('../package.json')

const program = new Command('srn')
program.version(pkg.version)

program
  .command('init')
  .description('åˆå§‹åŒ–react-native é¡¹ç›®å·¥ç¨‹')
  .option('-n, --name <name>', 'é¡¹ç›®åç§°')
  .action(init)

program
  .command('bundle')
  .description('react-native æ‰“æ•´åŒ…')
  .option('-e --entry <entry>', 'å…¥å£æ–‡ä»¶')
  .option('-o --outputDir <outputDir>', 'bundleè¾“å‡ºç›®å½•')
  .option('-p --platform <platform>', 'å¹³å°ï¼ˆandroid|ios)')
  .option('-a --assetsDest <assetsDest>', 'é™æ€èµ„æºè¾“å‡ºç›®å½•')
  .action(bundle)

program
  .command('zip')
  .description('bundleå‹ç¼©')
  .option('-n --name <name>', 'åç§°')
  .action(zipBundle)

program
  .command('fix')
  .description('ä¿®å¤react-nativeè¿è¡Œæ—¶é—®é¢˜')
  .option('-q, --question <question>', 'éœ€ä¿®å¤çš„é—®é¢˜')
  .action(fix)

program.parse(process.argv)

```
## react-nativeé¡¹ç›®åˆå§‹åŒ–å‘½ä»¤
```
export const init = async (options: {name: string}) => {
  const { name } = options
  const finalOptions = { ...options }
  if (!name) {
    const { name } = await inquirer.prompt([
      {
        type: 'input',
        name: 'name',
        message: 'project name:',
        validate: (input = '') => input.trim().length > 0
      }
    ])
    finalOptions.name = name
  }
  logger.log(banner)

  const spinner = ora(colors.green(`Setting up new React Native app in ${finalOptions.name}`))
  try {
    spinner.succeed()
    const projectDir = path.join(path.resolve(process.cwd()), finalOptions.name)
    const flag = mkdirSync(projectDir)
    if (!flag) {
      process.exit(1)
    }

    spinner.start('downloading template')
    const templatePath = path.resolve(__dirname, '../../template')
    copyProjectTemplateAndReplace(templatePath, projectDir, finalOptions.name)

    await delay((Math.random() + 0.4) * 10000)
    spinner.succeed(colors.green('download template'))

    spinner.start('creating appJson')
    addAppJson(projectDir, finalOptions.name)
    await delay(Math.random() * 4000)
    spinner.succeed(colors.green('created appJson'))

    spinner.succeed(colors.green(`successful created ${finalOptions.name}`))
  } catch (e) {
    spinner.stop()
  }
}
```
## ä¿®å¤react-native 0.55.4ç‰ˆæœ¬è¿è¡Œæ—¶é—®é¢˜çš„å‘½ä»¤
```
enum QuestionEnum {
  q0 = '1ã€[ios]MacOS è¿è¡ŒæŠ¥é”™ Could not find iPhone simulator',
  q1 = '2ã€[ios]third-part config.h not found; Entry, ":CFBundleIdentifier", Does Not Exist',
  q2 = '3ã€[ios]é‡åˆ° React Native å¯åŠ¨æŠ¥é”™çš„é—®é¢˜ getCurrentAppState:error å’Œ objectAtIndexedSubscript: çš„è§£å†³æ–¹æ¡ˆ',
  q3 = '4ã€[ios]Xcode12.5/æŠ¥é”™ï¼šCannot initialize a parameter of type â€˜NSArrayï¼œidï¼œRCTBridgeModuleï¼ï¼ *',
  q4 = '5ã€[build] Error fast-image OnProgressEvent',
  q5 = '6ã€[android] blacklist regex syntax errors'
}

export const fix = async (options: { question: string }) => {
  const { question } = options
  const finalOptions = { ...options }

  if (!question) {
    const { question } = await inquirer.prompt([
      {
        type: 'list',
        name: 'question',
        message: 'è¯·é€‰æ‹©ä¿®å¤çš„é—®é¢˜',
        choices: [QuestionEnum.q0, QuestionEnum.q1, QuestionEnum.q2, QuestionEnum.q3, QuestionEnum.q4, QuestionEnum.q5],
        default: 0
      }
    ])
    finalOptions.question = question
  }

  const spinner = ora(colors.green('é—®é¢˜ä¿®å¤ä¸­...'))
  spinner.start()

  let success: boolean = false
  switch (finalOptions.question) {
    case QuestionEnum.q0:
      success = fixQ0()
      break
    case QuestionEnum.q1:
      success = await fixQ1()
      break
    case QuestionEnum.q2:
      success = fixQ2()
      break
    case QuestionEnum.q3:
      success = fixQ3()
      break
    case QuestionEnum.q4:
      success = fixQ4()
      break
    case QuestionEnum.q5:
      success = fixQ5()
      break
  }

  if (success) spinner.succeed(colors.green('é—®é¢˜å·²ä¿®å¤'))
  spinner.stop()
}

```

## æ€»ç»“
- å¯ä»¥å°è£…è‡ªå·±çš„ä¸šåŠ¡ï¼Œé›†æˆåŸºç¡€æœåŠ¡ï¼Œæå‡å¼€å‘æ•ˆç‡

## ç»“æŸè¯­
- ğŸ‘€ ç›®å‰ä¸“æ³¨äºå‰ç«¯
- âš™ï¸ åœ¨reactã€react-nativeå¼€å‘æ–¹é¢æœ‰ä¸°å¯Œçš„ç»éªŒ
- ğŸ”­ æœ€è¿‘åœ¨å­¦ä¹ å®‰å“ï¼Œæœ‰è‡ªå·±çš„å¼€æºå®‰å“é¡¹ç›®ï¼Œé›†æˆreact-nativeçƒ­æ›´æ–°åŠŸèƒ½
- æˆ‘â¤ï¸ æ€è€ƒã€å­¦ä¹ ã€ç¼–ç å’Œå¥èº«
- å¦‚æœæ–‡ç« å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œä¸‰è¿æ”¯æŒä¸€ä¸‹ï½O(âˆ©_âˆ©)Oè°¢è°¢ï¼
